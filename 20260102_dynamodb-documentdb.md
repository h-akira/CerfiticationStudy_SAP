# DynamoDB と DocumentDB

作成日: 2026-01-02

## 概要

DynamoDBとDocumentDBはどちらもNoSQLデータベースですが、DynamoDBはAWS独自のキー・バリュー/ドキュメントDB、DocumentDBはMongoDB互換のドキュメントDBです。データモデル、スケーラビリティ、互換性、ユースケースが大きく異なります。

## 基本比較

| 項目 | DynamoDB | DocumentDB |
|---|---|---|
| **データベース種類** | キー・バリュー + ドキュメント | ドキュメント（MongoDB互換） |
| **互換性** | AWS独自API | MongoDB 3.6/4.0/5.0互換 |
| **スケーリング** | 自動（無制限） | 手動（最大15リードレプリカ） |
| **容量上限** | 実質無制限 | 64TiB/クラスタ |
| **最小構成** | サーバーレス可能 | 3インスタンス（1プライマリ + 2レプリカ、3AZ） |
| **料金モデル** | オンデマンド or プロビジョニング | インスタンス時間 + ストレージ + I/O |
| **クエリ言語** | PartiQL（SQL風）、API | MongoDB Query Language（MQL） |

## データモデル

### DynamoDB

| 項目 | 内容 |
|---|---|
| **テーブル構造** | パーティションキー + ソートキー（オプション） |
| **項目サイズ** | 最大400KB/項目 |
| **データ型** | スカラー、ドキュメント（リスト、マップ）、セット |
| **スキーマ** | スキーマレス（キーのみ定義） |
| **インデックス** | グローバルセカンダリインデックス（GSI）、ローカルセカンダリインデックス（LSI） |
| **トランザクション** | ACIDトランザクション対応（最大100項目） |

### DocumentDB

| 項目 | 内容 |
|---|---|
| **コレクション構造** | MongoDB互換のコレクション |
| **ドキュメントサイズ** | 最大16MB/ドキュメント |
| **データ型** | BSON（JSON拡張）、ネストしたドキュメント |
| **スキーマ** | スキーマレス（柔軟） |
| **インデックス** | 単一フィールド、複合、TTL、部分、ワイルドカード |
| **トランザクション** | ACIDトランザクション対応（MongoDB 4.0以降） |

## パフォーマンスとスケーラビリティ

### DynamoDB

| 項目 | 内容 |
|---|---|
| **読み取り** | 結果整合性 or 強い整合性 |
| **書き込み** | 自動パーティショニング |
| **スループット** | オンデマンド（無制限）or プロビジョニング（手動設定） |
| **レイテンシ** | 1桁ミリ秒（Single-Digit Millisecond） |
| **自動スケーリング** | 完全自動（オンデマンドモード） |
| **グローバルテーブル** | マルチリージョンレプリケーション |
| **DAX** | マイクロ秒レイテンシのインメモリキャッシュ |

### DocumentDB

| 項目 | 内容 |
|---|---|
| **読み取り** | プライマリ or リードレプリカ（最大15） |
| **書き込み** | プライマリインスタンスのみ |
| **ストレージ** | 自動拡張（10GB〜64TiB） |
| **レイテンシ** | ミリ秒単位 |
| **スケーリング** | 垂直（インスタンスサイズ変更）、水平（リードレプリカ追加） |
| **グローバルクラスタ** | クロスリージョンリードレプリカ |
| **キャッシュ** | インスタンスのバッファキャッシュ |

## 可用性とバックアップ

### DynamoDB

| 項目 | 内容 |
|---|---|
| **可用性** | 99.99%（標準）、99.999%（グローバルテーブル） |
| **レプリケーション** | 3つのAZに自動レプリケーション |
| **バックアップ** | ポイントインタイムリカバリ（PITR、35日）、オンデマンドバックアップ |
| **リストア** | 新しいテーブルとして復元 |
| **グローバルテーブル** | マルチリージョン、自動レプリケーション、競合解決（Last Write Wins） |

### DocumentDB

| 項目 | 内容 |
|---|---|
| **可用性** | 99.99%（マルチAZ） |
| **レプリケーション** | 6コピー（3AZ × 2コピー）、ストレージレベル |
| **バックアップ** | 自動バックアップ（1〜35日保持）、スナップショット |
| **リストア** | 新しいクラスタとして復元、ポイントインタイムリカバリ |
| **グローバルクラスタ** | 最大5リージョン、1秒未満のRPO |

## クエリとインデックス

### DynamoDB

| クエリタイプ | 説明 | パフォーマンス |
|---|---|---|
| **GetItem** | パーティションキーで単一項目取得 | 最速（1桁ms） |
| **Query** | パーティションキー + ソートキー範囲 | 高速 |
| **Scan** | テーブル全体スキャン | 遅い（大規模データで非推奨） |
| **GSI** | 別のキーでクエリ可能 | 追加コスト、非同期更新 |
| **LSI** | 同じパーティション内で別ソートキー | テーブル作成時のみ設定可 |

**制約**:
- クエリは必ずパーティションキーを指定
- 複雑なJOINやアグリゲーションは不向き

### DocumentDB

| クエリタイプ | 説明 | パフォーマンス |
|---|---|---|
| **find()** | MongoDBクエリ言語 | インデックス次第 |
| **aggregate()** | アグリゲーションパイプライン | 複雑な集計可能 |
| **複合インデックス** | 複数フィールドの組み合わせ | 柔軟なクエリ最適化 |
| **ワイルドカード** | 動的フィールドのインデックス | スキーマレスに対応 |

**利点**:
- MongoDBのクエリ言語をそのまま使用可能
- 複雑なアグリゲーション、JOINライクな操作対応

## MongoDB互換性

### DocumentDB

| 項目 | 内容 |
|---|---|
| **対応バージョン** | MongoDB 3.6、4.0、5.0互換 |
| **ドライバ** | 公式MongoDBドライバ使用可能 |
| **移行** | AWS Database Migration Service（DMS） |
| **制限** | 一部機能非対応（Change Streams一部制限、Map-Reduce等） |

**移行が容易なケース**:
- 既存のMongoDBアプリケーション
- MongoDBの運用管理をAWSに委託したい

### DynamoDB

- MongoDB互換性なし
- アプリケーションの書き換え必要
- AWS SDK、PartiQLを使用

## 料金モデル

### DynamoDB

| 料金要素 | オンデマンド | プロビジョニング |
|---|---|---|
| **読み取り** | $1.25/百万リクエスト | $0.00013/RCU/時間 |
| **書き込み** | $1.25/百万リクエスト | $0.00065/WCU/時間 |
| **ストレージ** | $0.25/GB/月 | $0.25/GB/月 |
| **グローバルテーブル** | リージョン間レプリケーション料金 | 同左 |
| **バックアップ** | PITR: $0.20/GB/月、オンデマンド: $0.10/GB | 同左 |

**プロビジョニング**: 予測可能なワークロード、コスト削減（最大75%）
**オンデマンド**: 予測不可能なワークロード、スパイク対応

### DocumentDB

| 料金要素 | 内容 |
|---|---|
| **インスタンス** | $0.277/時間（db.r6g.large）〜 |
| **ストレージ** | $0.10/GB/月 |
| **I/O** | $0.20/百万リクエスト |
| **バックアップ** | $0.021/GB/月（保持期間超過分） |
| **データ転送** | リージョン間転送で課金 |

**最小構成例**: db.t3.medium × 3 = 約$200/月〜

## セキュリティ

| 項目 | DynamoDB | DocumentDB |
|---|---|---|
| **暗号化（保管時）** | AWS KMS（デフォルト） | AWS KMS（デフォルト） |
| **暗号化（転送中）** | TLS | TLS |
| **認証** | IAM、IAMポリシー | IAMデータベース認証、ユーザー名/パスワード |
| **ネットワーク分離** | VPCエンドポイント | VPC内のみ（パブリックアクセス不可） |
| **監査** | CloudTrail（API）、CloudWatch Logs | CloudWatch Logs、Profiler |

## ユースケース別推奨

| ユースケース | 推奨 | 理由 |
|---|---|---|
| **ハイスケール・低レイテンシ** | DynamoDB | 自動スケーリング、1桁msレイテンシ |
| **既存MongoDB移行** | DocumentDB | MongoDB互換、移行容易 |
| **シンプルなキー・バリュー** | DynamoDB | シンプル、コスト効率 |
| **複雑なクエリ・集計** | DocumentDB | アグリゲーションパイプライン |
| **グローバル分散** | DynamoDB | グローバルテーブル、マルチリージョン |
| **セッションストア** | DynamoDB | 高速、TTL機能 |
| **カタログ・在庫管理** | DocumentDB | 柔軟なスキーマ、複雑な検索 |
| **IoT時系列データ** | DynamoDB | 高スループット、Time to Live（TTL） |
| **コンテンツ管理システム** | DocumentDB | ネストしたドキュメント、柔軟性 |
| **ゲームリーダーボード** | DynamoDB | 低レイテンシ、ソート済みセット風の操作 |

## 主な機能比較

### DynamoDB独自機能

| 機能 | 説明 |
|---|---|
| **DynamoDB Streams** | テーブル変更のストリーミング（Lambda統合） |
| **Time to Live（TTL）** | 項目の自動削除（期限切れデータ） |
| **DAX** | マイクロ秒レイテンシのインメモリキャッシュ |
| **PartiQL** | SQL風のクエリ言語 |
| **グローバルテーブル** | マルチリージョン、マルチマスター |

### DocumentDB独自機能

| 機能 | 説明 |
|---|---|
| **Change Streams** | リアルタイムデータ変更通知 |
| **アグリゲーション** | 複雑な集計パイプライン |
| **MongoDB互換** | MongoDBツール・ドライバ使用可能 |
| **Elastic Clusters** | 水平スケーリング、ペタバイト規模対応（プレビュー） |

## 移行パス

### MongoDBからの移行

| 移行元 | 移行先 | ツール | 特徴 |
|---|---|---|---|
| MongoDB（オンプレ/他クラウド） | DocumentDB | AWS DMS | ダウンタイム最小化、継続的レプリケーション |
| MongoDB Atlas | DocumentDB | mongodump/mongorestore | オフライン移行 |
| MongoDB | DynamoDB | カスタム開発 | アプリケーション書き換え必要 |

### DynamoDBへの移行

- **SQL DB → DynamoDB**: AWS DMS、データモデル再設計必要
- **他NoSQL → DynamoDB**: カスタムスクリプト、AWS Data Pipeline

## SAP試験の重要ポイント

### DynamoDB

- **スケーリング**: 自動、無制限（オンデマンドモード）
- **レイテンシ**: 1桁ミリ秒
- **データモデル**: パーティションキー必須、400KB/項目
- **グローバルテーブル**: マルチリージョン、マルチマスター
- **TTL**: 自動削除機能
- **DAX**: マイクロ秒キャッシュ

### DocumentDB

- **MongoDB互換**: 3.6/4.0/5.0、ドライバ・ツール使用可能
- **最小構成**: 3インスタンス（3AZ）
- **容量**: 最大64TiB/クラスタ
- **リードレプリカ**: 最大15、読み取りスケールアウト
- **VPC**: VPC内のみ、パブリックアクセス不可

### 使い分け

- **既存MongoDB** → DocumentDB
- **ハイスケール・低レイテンシ** → DynamoDB
- **複雑なクエリ・集計** → DocumentDB
- **グローバル分散** → DynamoDB
- **16MB超ドキュメント** → DocumentDBも不可、S3 + メタデータ検討
